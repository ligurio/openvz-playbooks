---
# Configuration for Mailman 2

#
# Packages
#

- name: install needed packages
  yum: pkg={{ item }} state=present
  with_items:
  - mailman
  sudo: yes

- name: update mail aliases
  copy: src=aliases dest=/etc/aliases owner=root group=root mode=644
  sudo: yes
  notify: newaliases

#
# Initialize mailman (must be done after settings up the DBs)
#
#- name: add mailman to the apache group
#  user: name=mailman groups=apache append=yes shell=/sbin/nologin
#  #notify:
#  #  - restart mailman3

# access to the aliases files generated by mailman
#- name: add sendmail to the mailman group
#  user: name=sendmail groups=mailman append=yes
#  notify:
#    - restart sendmail

## for access to the full-text index
#- name: add apache to the mailman group
#  user: name=apache groups=mailman append=yes shell=/sbin/nologin
#  notify:
#    - restart httpd

#- name: set the mailman conffile
#  template: src={{ item }} dest=/etc/mailman.cfg
#  with_first_found:
#  - mailman.cfg.{{ ansible_hostname }}.j2
#  - mailman.cfg.j2
#  notify:
#    - restart mailman

#
# Logging

## Sendmail
#- name: create the sendmail aliases
#  command: su mailman -s /bin/sh -c "mailman3 aliases"
#           creates=/var/lib/mailman3/data/postfix_lmtp.db

# Start services
#- name: start services
#  service: state=started enabled=yes name={{ item }}
#  with_items:
#  - httpd
#  - mailman
#  - sendmail
